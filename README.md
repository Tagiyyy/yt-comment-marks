## YouTube見どころマーカー

### YouTube Comment Timestamp Markers

YouTubeのコメント欄に含まれるタイムスタンプを検出し、動画プレイヤーのシークバー上にマーカーとして表示するChrome拡張です。コメント近傍のテキストも解析し、将来的なツールチップ等で利用できるようマーカーに保持します。

## 機能

- **コメントのタイムスタンプ検出**: `MM:SS` / `HH:MM:SS` 形式や、URLの `t` / `start` パラメータ（例: `1h2m3s`, `90s`, `123`）を解析。
- **シークバーへマーカー表示**: YouTubeのネイティブ進捗バーにオレンジ色のマーカーを重ねて表示。
- **クリックでジャンプ**: マーカーをクリックすると該当位置へ移動（可能ならコメント内リンクの処理を優先して発火）。
- **コメント抜粋の保持**: タイムスタンプ前後の近い行からテキストを抽出し、マーカーのデータ属性（`data-tooltip`）として保持（現状は表示UI未実装）。
- **自動追従**: コメントの遅延読み込みやYouTubeのページ内遷移（`yt-navigate-finish`）にも追従し、マーカーを更新。
- **重複抑制**: 近接位置の重複マーカーをスキップ（±0.2%以内）。
- **多言語対応**: 英語/日本語のローカライズ。

## インストール（ローカル）

1. リポジトリをクローンまたはZIPをダウンロードして展開。
2. Chromeで `chrome://extensions` を開く。
3. 右上の「デベロッパーモード」を有効化。
4. 「パッケージ化されていない拡張機能を読み込む」から、このリポジトリのルートディレクトリを選択。

インストール後、YouTubeの任意の動画ページ（`https://www.youtube.com/*`）で有効になります。

## 使い方

1. YouTubeの動画ページを開く。
2. コメント欄にタイムスタンプ（例: `1:23` や `https://...&t=83s`）があると、シークバーにマーカーが表示されます。
3. マーカーをクリックすると該当位置に移動します。

## 対応しているタイムスタンプ

- **テキスト内**: `00:12`, `1:23`, `1:23:45`
- **URLパラメータ**: `t` / `start`
  - 例: `1h2m3s`, `90s`, `123`

動画の総再生時間を超えるタイムスタンプはマーカー化しません。

## 仕組み（概要）

- `content_scripts` がYouTubeの視聴ページで実行され、コメント内のリンクやタイムスタンプ文字列を解析します（`src/content.js`）。
- マーカーはYouTubeの進捗バー（`.ytp-progress-bar`）上に `div.ytcm-marker` を生成して表示します（`src/overlay.css`）。
- マーカークリック時は、可能なら元のコメント内リンクに対してクリックイベントを発火してYouTube側の処理を利用し、難しい場合は直接 `video.currentTime` を設定します（バッファ内のみ）。
- コメントの遅延読み込みやページ内遷移を `MutationObserver` と `yt-navigate-finish` イベントで検出して再スキャンします。
- コメント近傍テキストは `data-tooltip` 属性として保存します（現状表示UIは未実装）。

## 権限

- `host_permissions`: `https://www.youtube.com/*`

この拡張は外部通信を行わず、ユーザーデータを収集しません。

## 既知の制限

- YouTubeのUI変更により、マーカーの見た目や位置が崩れる可能性があります。
- マーカーのフォールバック挙動（直接シーク）は、指定位置がバッファ済みの場合のみ行います。
- コメントの構造や言語に強く依存するため、まれに意図しないテキストがツールチップに表示される場合があります。

## 開発・デバッグ

- 主要ファイル: `manifest.json`, `src/content.js`, `src/overlay.css`（`src/logger.js` はコンソールロガーの実験用です）。
- コンソールログ: `[YT-CM]` でフィルタするとデバッグ出力を確認できます。
- 変更後は `chrome://extensions` の該当拡張で「更新」を押して反映してください。

## ローカライズ

- 既定言語は英語（`_locales/en`）。日本語（`_locales/ja`）を同梱しています。

## トラブルシューティング

- **マーカーが出ない**
  - コメント欄が表示されるまでスクロールしてください。
  - 他のYouTube関連拡張を一時的に無効化して競合を確認してください。
  - 開発者ツールのコンソールで `[YT-CM]` ログとエラーの有無を確認してください。
  - 拡張を再読み込み、ページを再読込してください。

## ライセンス

本リポジトリには明示的なライセンスファイルが含まれていません。利用や再配布に関しては、リポジトリ所有者の方針に従ってください。


